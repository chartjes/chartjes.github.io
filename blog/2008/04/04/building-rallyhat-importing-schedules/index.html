<!DOCTYPE html>
<html>
    <head lang="en">
        <title>Building Rallyhat: Importing Schedules &mdash; Grumpy Learning &mdash; Where even the CSS is grumpy</title>
        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
            <meta name="robots" content="index, follow">
        <link rel="stylesheet" href="https://grumpy-learning.com/build/app.css">

        <link rel="apple-touch-startup-image" href="https://grumpy-learning.com/build/2048x2048.png">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="shortcut icon" sizes="76x76" href="https://grumpy-learning.com/build/jackson/76x76.png">
        <link rel="shortcut icon" sizes="120x120" href="https://grumpy-learning.com/build/jackson/120x120.png">
        <link rel="shortcut icon" sizes="128x128" href="https://grumpy-learning.com/build/jackson/128x128.png">
        <link rel="shortcut icon" sizes="152x152" href="https://grumpy-learning.com/build/jackson/152x152.png">
        <link rel="shortcut icon" sizes="196x196" href="https://grumpy-learning.com/build/jackson/196x196.png">
        <link rel="shortcut icon" sizes="512x512" href="https://grumpy-learning.com/build/jackson/512x512.png">
        <link rel="shortcut icon" sizes="1024x1024" href="https://grumpy-learning.com/build/jackson/1024x1024.png">
        <link rel="shortcut icon" sizes="2048x2048" href="https://grumpy-learning.com/build/jackson/2048x2048.png">
        <link rel="apple-touch-icon" sizes="76x76" href="https://grumpy-learning.com/build/jackson/76x76.png">
        <link rel="apple-touch-icon" sizes="120x120" href="https://grumpy-learning.com/build/jackson/120x120.png">
        <link rel="apple-touch-icon" sizes="128x128" href="https://grumpy-learning.com/build/jackson/128x128.png">
        <link rel="apple-touch-icon" sizes="152x152" href="https://grumpy-learning.com/build/jackson/152x152.png">
        <link rel="apple-touch-icon" sizes="196x196" href="https://grumpy-learning.com/build/jackson/196x196.png">
        <link rel="apple-touch-icon" sizes="512x512" href="https://grumpy-learning.com/build/jackson/512x512.png">
        <link rel="apple-touch-icon" sizes="1024x1024" href="https://grumpy-learning.com/build/jackson/1024x1024.png">
        <link rel="apple-touch-icon" sizes="2048x2048" href="https://grumpy-learning.com/build/jackson/2048x2048.png">

        <link rel="alternate" type="application/atom+xml" href="https://grumpy-learning.com/atom.xml" title="Grumpy Learning activity feed" />
                                    </head>
    <body>
        <header>
            <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
                <div class="container">
                    <a class="navbar-brand" href="https://grumpy-learning.com/">Grumpy Learning</a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarCollapse">
                        <ul class="navbar-nav mr-auto">
                            <li class="nav-item"><a class="nav-link" href="https://grumpy-learning.com/blog">Posts Archive</a></li>
                            <li class="nav-item"><a class="nav-link" href="https://grumpy-learning.com/blog/categories">Categories</a></li>
                            <li class="nav-item"><a class="nav-link" href="https://grumpy-learning.com/blog/tags">Tags</a></li>
                            <li class="nav-item"><a class="nav-link" href="https://grumpy-learning.com/about">About</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>
        <main role="main" class="container">
            <div class="row">
                <div class="col-sm-7">
                        <article class="h-entry">
        <header>
            <h2><div class="p-name">Building Rallyhat: Importing Schedules</div> <small>post</small></h2>
        </header>
        <div class="e-content">
            <p>I continue to be impressed with <a href="http://www.djangoproject.com">Django</a> as I build out Rallyhat.  I have an extreme alpha version working on my laptop, minus the Yahoo! Maps stuff I've been playing around with.  The biggest task was populating my database with the schedules for all the baseball teams.  I thought I'd share what the import script looks like:
</p>

<p>
~~~
#!/usr/bin/env python
from django.core.management import setup_environ
import settings
setup_environ(settings)
from rallyhat.www.models import Team
from rallyhat.www.models import Game
from rallyhat.www.models import Location
from rallyhat.www.models import Sport

from datetime import date

import csv, urllib, time

s = Sport.objects.get(name='Major League Baseball')
teamSchedules = Team.objects.all()

for teamSchedule in teamSchedules:
    scheduleFile = teamSchedule.schedule
    print "Importing games for " + str(teamSchedule.name)

    if scheduleFile != "":
        reader = csv.reader(urllib.urlopen(scheduleFile))

        for row in reader:
            teams = row[3].split(' at ')

            if len(teams) == 2:
                if Team.objects.filter(name=teams[1]).count() == 0:
                    print "Adding new team: " + teams[1]
                    homeTeam = Team(name=teams[1], sport=s)
                    homeTeam.save()
                else:
                    homeTeam = Team.objects.get(name=teams[1])

                if Team.objects.filter(name=teams[0]).count() == 0:
                    print "Adding new team: " + teams[0]
                    awayTeam = Team(name=teams[0], sport=s)
                    awayTeam.save()
                else:
                    awayTeam = Team.objects.get(name=teams[0])

                gameDate = time.strftime("%Y-%m-%d", time.strptime(row[0], "%m/%d/%Y"))
                startTime = time.strftime("%H:%M", time.strptime(row[2], "%I:%M %p"))

                # If this game doesn't exist, add it to the system
                if Game.objects.filter(home_team=homeTeam, away_team=awayTeam, game_date=gameDate, start_time=startTime).count() == 0:
                    locationCheck = Location.objects.filter(name=row[4]).count()

                    if locationCheck == 0:
                        print "Adding new location: " + row[4]
                        l = Location(name=row[4])
                        l.save()
                    else:
                        l = Location.objects.get(name=row[4])

                    locationId = l.id
                    g = Game(home_team=homeTeam, away_team=awayTeam, location=l, game_date=gameDate, start_time=startTime)
                    g.save()
~~~
</p>

<p>
It's interesting to treat everything as an object after so many years of being in the PHP world where you can mix and match depending on what's been going on in your application.  I'm also amazed at how clear the code is.  There is some non-intuitive stuff in there, especially when dealing with the saving of model records.  It took me a while to figure out I could pass the object containing the model  as a parameter when saving a record for a model that it is associated with.
</p>

        </div>
                        <a href="https://brid.gy/publish/mastodon"</a>
        <a href="https://brid.gy/publish/twitter"</a>
                    <nav class="article">
                <ul>
                                            <li>Next: <a class="next" href="https://grumpy-learning.com/blog/2008/04/09/the-rise-of-the-app-cloud/" title="The Rise of the App Cloud"><span class="title">The Rise of the App Cloud</span></a></li>
                                                                <li>Previous: <a class="previous" href="https://grumpy-learning.com/blog/2008/04/01/deployment-horror-stories/" title="Deployment Horror Stories"><span class="title">Deployment Horror Stories</span></a></li>
                                    </ul>
            </nav>
            </article>
                </div>
                <div class="col-sm-5 sidebar">
                    <div class="card bg-light">
                        <div class="card-header">Grumpy Learning</div>
                        <div class="card-body">
                            <small>Where even the CSS is grumpy</small>                        </div>
                    </div>
                    <div class="card bg-light sidebar-nav">
                        <div class="card-body">
                            <form method="get" id="search" action="/search.js">
                                <label hidden for="search-input">Search site</label>
                                <input type="text" id="search-input" name="query" placeholder="Type here to search">
                                <input type="submit" value="search">
                            </form>
                            (Search might be rough for a while as engines index all the new old content)
                        </div>
                        <div class="card-header">Videos to make you less grumpy</div>
                        <div class="card-body">
                            <ul class="nav flex-column">
                                <li class="nav-item"><a class="nav-link" href="https://grumpy-learning.com/testing-things-wrong">You're (Probably) Testing Things Wrong</a> is a 2 hour video looking at how to test your PHP code and ways that you might be doing it wrong.</li>
                            </ul>
                        </div>
                        <div class="card-header">Books to make you less grumpy</div>
                        <div class="card-body">
                            <ul class="nav flex-column">
                                <li class="nav-item"><a class="nav-link" href="https://leanpub.com/grumpy-guide">The Grumpy Programmer's Guide To Testing PHP Applications</a></li>
                                <li class="nav-item"><a class="nav-link" href="https://leanpub.com/grumpy-complements">The Complementary PHP Testing Tools Cookbook</a></li>
                            </ul>
                        </div>
                    <div class="card bg-light sidebar-nav">
                        <div class="card-header">How to get in touch</div>
                        <div class="card-body">
                            <ul class="nav flex-column">
                                <li class="nav-item">I'm <a rel="author" class="p-author h-card">Chris Hartjes</a></li>
                                <li class="nav-item">I'm on Mastodon as <a rel="me" class="nav-link" href="https://phpc.social/@grmpyprogrammer">@grmpyprogrammer@phpc.social</a></li>
                                <li class="nav-item">I don't do much OSS any more but you can find my stuff on <a rel="me" class="nav-link" href="https://github.com/chartjes">GitHub</a></li>
                                <li class="nav-item">Want to ask a question? Want to hire me to do some consulting work? Interested in having me speak at your event or on your podcast? Email me at <a class="nav-link" href="mailto:chartjes@grumpy-learning.com">chartjes@grumpy-learning.com</a>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <footer class="container">
            <span class="text-muted">&copy; 2021 - 2023 Grumpy Learning</span>
        </footer>

        <script src="https://grumpy-learning.com/build/app.js"></script>
        <script src="https://unpkg.com/lunr/lunr.js"></script>
                
        
                    </body>
</html>
